{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/lib/services/productService.ts"],"sourcesContent":["import { Producto } from \"@/lib/types\";\r\nimport { refresh } from \"./userService\"; // si quieres auto‑refresh\r\n\r\nconst API_BASE_URL = \"/api/8080/catalog-service\";\r\n\r\n/* ------------------------------------------------------------------ */\r\n/* Helper para añadir Authorization                                    */\r\n/* ------------------------------------------------------------------ */\r\nconst authHeader = (): HeadersInit => {\r\n    const token = localStorage.getItem(\"accessToken\");\r\n    console.log(\"Auth header:\", token)\r\n    return token ? { Authorization: `Bearer ${token}` } : {};\r\n};\r\n\r\n/* ------------------------------------------------------------------ */\r\n/* 1.  Rutas PÚBLICAS                                                  */\r\n/* ------------------------------------------------------------------ */\r\n\r\nexport async function getProducts(): Promise<{ products: Producto[] }> {\r\n    const res = await fetch(`${API_BASE_URL}/products/`);\r\n    if (!res.ok)\r\n        throw new Error(\"No se pudieron obtener los productos del Kwik‑E‑Mart\");\r\n    return res.json();\r\n}\r\n\r\nexport async function getProductById(id: number): Promise<Producto> {\r\n    const res = await fetch(`${API_BASE_URL}/products/${id}`);\r\n    if (!res.ok)\r\n        throw new Error(`No se pudo encontrar el producto con ID ${id}`);\r\n    return res.json();\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/* 2.  Rutas PROTEGIDAS (requieren JWT)                               */\r\n/* ------------------------------------------------------------------ */\r\n\r\nexport async function createProduct(\r\n    product: Omit<Producto, \"id\">\r\n): Promise<Producto> {\r\n    const res = await fetch(`${API_BASE_URL}/products/`, {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            ...authHeader(),\r\n        },\r\n        body: JSON.stringify(product),\r\n    });\r\n\r\n    if (res.status === 401) {\r\n        throw new Error(\"No autorizado: inicia sesión de nuevo.\");\r\n    }\r\n\r\n    if (!res.ok) throw new Error(\"Error al intentar crear el producto\");\r\n    return res.json();\r\n}\r\n\r\nexport async function updateProduct(\r\n    id: number,\r\n    product: Partial<Producto>\r\n): Promise<Producto> {\r\n    const res = await fetch(`${API_BASE_URL}/products/${id}`, {\r\n        method: \"PUT\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            ...authHeader(),\r\n        },\r\n        body: JSON.stringify(product),\r\n    });\r\n\r\n    if (res.status === 401)\r\n        throw new Error(\"No autorizado: inicia sesión de nuevo.\");\r\n    if (!res.ok) throw new Error(`Error al actualizar el producto ${id}`);\r\n    return res.json();\r\n}\r\n\r\nexport async function deleteProduct(id: number): Promise<void> {\r\n    const res = await fetch(`${API_BASE_URL}/products/${id}`, {\r\n        method: \"DELETE\",\r\n        headers: authHeader(),\r\n    });\r\n\r\n    if (res.status === 401)\r\n        throw new Error(\"No autorizado: inicia sesión de nuevo.\");\r\n    if (!res.ok) throw new Error(`Error al eliminar el producto ${id}`);\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAGA,MAAM,eAAe;AAErB,sEAAsE,GACtE,uEAAuE,GACvE,sEAAsE,GACtE,MAAM,aAAa;IACf,MAAM,QAAQ,aAAa,OAAO,CAAC;IACnC,QAAQ,GAAG,CAAC,gBAAgB;IAC5B,OAAO,QAAQ;QAAE,eAAe,CAAC,OAAO,EAAE,OAAO;IAAC,IAAI,CAAC;AAC3D;AAMO,eAAe;IAClB,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,CAAC;IACnD,IAAI,CAAC,IAAI,EAAE,EACP,MAAM,IAAI,MAAM;IACpB,OAAO,IAAI,IAAI;AACnB;AAEO,eAAe,eAAe,EAAU;IAC3C,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,EAAE,IAAI;IACxD,IAAI,CAAC,IAAI,EAAE,EACP,MAAM,IAAI,MAAM,CAAC,wCAAwC,EAAE,IAAI;IACnE,OAAO,IAAI,IAAI;AACnB;AAMO,eAAe,cAClB,OAA6B;IAE7B,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,CAAC,EAAE;QACjD,QAAQ;QACR,SAAS;YACL,gBAAgB;YAChB,GAAG,YAAY;QACnB;QACA,MAAM,KAAK,SAAS,CAAC;IACzB;IAEA,IAAI,IAAI,MAAM,KAAK,KAAK;QACpB,MAAM,IAAI,MAAM;IACpB;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,IAAI;AACnB;AAEO,eAAe,cAClB,EAAU,EACV,OAA0B;IAE1B,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,EAAE,IAAI,EAAE;QACtD,QAAQ;QACR,SAAS;YACL,gBAAgB;YAChB,GAAG,YAAY;QACnB;QACA,MAAM,KAAK,SAAS,CAAC;IACzB;IAEA,IAAI,IAAI,MAAM,KAAK,KACf,MAAM,IAAI,MAAM;IACpB,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,gCAAgC,EAAE,IAAI;IACpE,OAAO,IAAI,IAAI;AACnB;AAEO,eAAe,cAAc,EAAU;IAC1C,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,EAAE,IAAI,EAAE;QACtD,QAAQ;QACR,SAAS;IACb;IAEA,IAAI,IAAI,MAAM,KAAK,KACf,MAAM,IAAI,MAAM;IACpB,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,IAAI;AACtE","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/lib/services/promoService.ts"],"sourcesContent":["// lib/services/promoService.ts\r\n\r\nimport { Promo, PromoProductoRelacion } from \"../types\";\r\n\r\n// Para crear la relación no necesitamos el campo `id`\r\nexport type PromoProductCreate = {\r\n  idPromo: number;\r\n  idProducto: number;\r\n};\r\n\r\nconst authHeader = (): HeadersInit => {\r\n    const token = localStorage.getItem(\"accessToken\");\r\n    return token ? { Authorization: `Bearer ${token}` } : {};\r\n};\r\n\r\nconst API_BASE_URL = \"/api/8080/catalog-service\";\r\n\r\n/**\r\n * GET /promotions\r\n */\r\nexport async function getPromos(): Promise<{ promotions: Promo[] }> {\r\n  const res = await fetch(`${API_BASE_URL}/promotions/`, {\r\n    headers: authHeader(),\r\n  });\r\n  if (!res.ok) throw new Error(\"No se pudieron obtener las promociones\");\r\n  return res.json();\r\n}\r\n\r\n/**\r\n * POST /promotions\r\n */\r\nexport async function createPromo(\r\n  promoData: Omit<Promo, \"id\">\r\n): Promise<Promo> {\r\n  const res = await fetch(`${API_BASE_URL}/promotions/`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      ...authHeader(),\r\n    },\r\n    body: JSON.stringify(promoData),\r\n  });\r\n  if (!res.ok) throw new Error(\"Error al crear la promoción\");\r\n  return res.json();\r\n}\r\n\r\n/**\r\n * GET /promotions/promo-productos\r\n */\r\nexport async function getProductPromoRelations(): Promise<{\r\n  products: PromoProductoRelacion[];\r\n}> {\r\n  const res = await fetch(`${API_BASE_URL}/promotions/promo-productos/`, {\r\n    headers: authHeader(),\r\n  });\r\n  if (!res.ok)\r\n    throw new Error(\"No se pudieron obtener relaciones promoción–producto\");\r\n  return res.json();\r\n}\r\n\r\n/**\r\n * POST /promotions/promo-productos\r\n */\r\nexport async function assignPromoToProduct(\r\n  relation: PromoProductCreate\r\n): Promise<void> {\r\n  const res = await fetch(`${API_BASE_URL}/promotions/promo-productos/`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      ...authHeader(),\r\n    },\r\n    body: JSON.stringify(relation),\r\n  });\r\n  if (!res.ok)\r\n    throw new Error(\"Error al asignar la promoción al producto\");\r\n}\r\n\r\n/**\r\n * Helper cliente‑side para filtrar promociones de un producto\r\n */\r\nexport async function getPromosForProduct(\r\n  productId: number\r\n): Promise<Promo[]> {\r\n  const [all, { products: rels }] = await Promise.all([\r\n    getPromos(),\r\n    getProductPromoRelations(),\r\n  ]);\r\n  const ids = rels\r\n    .filter((r) => r.idProducto === productId)\r\n    .map((r) => r.idPromo);\r\n  return all.promotions.filter((p) => ids.includes(p.id));\r\n}\r\n"],"names":[],"mappings":"AAAA,+BAA+B;;;;;;;;AAU/B,MAAM,aAAa;IACf,MAAM,QAAQ,aAAa,OAAO,CAAC;IACnC,OAAO,QAAQ;QAAE,eAAe,CAAC,OAAO,EAAE,OAAO;IAAC,IAAI,CAAC;AAC3D;AAEA,MAAM,eAAe;AAKd,eAAe;IACpB,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,YAAY,CAAC,EAAE;QACrD,SAAS;IACX;IACA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe,YACpB,SAA4B;IAE5B,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,YAAY,CAAC,EAAE;QACrD,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,GAAG,YAAY;QACjB;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe;IAGpB,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,4BAA4B,CAAC,EAAE;QACrE,SAAS;IACX;IACA,IAAI,CAAC,IAAI,EAAE,EACT,MAAM,IAAI,MAAM;IAClB,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe,qBACpB,QAA4B;IAE5B,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,4BAA4B,CAAC,EAAE;QACrE,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,GAAG,YAAY;QACjB;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EACT,MAAM,IAAI,MAAM;AACpB;AAKO,eAAe,oBACpB,SAAiB;IAEjB,MAAM,CAAC,KAAK,EAAE,UAAU,IAAI,EAAE,CAAC,GAAG,MAAM,QAAQ,GAAG,CAAC;QAClD;QACA;KACD;IACD,MAAM,MAAM,KACT,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,WAC/B,GAAG,CAAC,CAAC,IAAM,EAAE,OAAO;IACvB,OAAO,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC,IAAM,IAAI,QAAQ,CAAC,EAAE,EAAE;AACvD","debugId":null}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/lib/promo-adapter.ts"],"sourcesContent":["// lib/promo-adapter.ts (Versión corregida y enriquecida)\r\n\r\nimport { Promo, PromoAplicada } from \"./types\";\r\n\r\nexport function adaptApiPromo(promo?: Promo): PromoAplicada | undefined {\r\n    if (!promo) {\r\n        return undefined;\r\n    }\r\n\r\n    const basePromo = {\r\n        id: promo.id,\r\n        nombre: promo.nombre,\r\n        descripcion: promo.descripcion,\r\n        diasSemana: promo.diasSemana,\r\n    };\r\n\r\n    switch (promo.tipo) {\r\n        case \"descuento\":\r\n            if (typeof promo.valor === \"number\") {\r\n                return { ...basePromo, tipo: \"descuento\", valor: promo.valor };\r\n            }\r\n            return undefined;\r\n        case \"2x1\":\r\n            return { ...basePromo, tipo: \"2x1\" };\r\n        case \"nuevo\":\r\n            return { ...basePromo, tipo: \"nuevo\" };\r\n        case \"solo-hoy\":\r\n            return { ...basePromo, tipo: \"solo-hoy\" };\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAAA,yDAAyD;;;;AAIlD,SAAS,cAAc,KAAa;IACvC,IAAI,CAAC,OAAO;QACR,OAAO;IACX;IAEA,MAAM,YAAY;QACd,IAAI,MAAM,EAAE;QACZ,QAAQ,MAAM,MAAM;QACpB,aAAa,MAAM,WAAW;QAC9B,YAAY,MAAM,UAAU;IAChC;IAEA,OAAQ,MAAM,IAAI;QACd,KAAK;YACD,IAAI,OAAO,MAAM,KAAK,KAAK,UAAU;gBACjC,OAAO;oBAAE,GAAG,SAAS;oBAAE,MAAM;oBAAa,OAAO,MAAM,KAAK;gBAAC;YACjE;YACA,OAAO;QACX,KAAK;YACD,OAAO;gBAAE,GAAG,SAAS;gBAAE,MAAM;YAAM;QACvC,KAAK;YACD,OAAO;gBAAE,GAAG,SAAS;gBAAE,MAAM;YAAQ;QACzC,KAAK;YACD,OAAO;gBAAE,GAAG,SAAS;gBAAE,MAAM;YAAW;QAC5C;YACI,OAAO;IACf;AACJ","debugId":null}},
    {"offset": {"line": 189, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/hooks/useProductsPromo.tsx"],"sourcesContent":["// hooks/useProductosPromo.ts\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getProducts } from \"@/lib/services/productService\";\r\nimport {\r\n    getPromos,\r\n    getProductPromoRelations,\r\n} from \"@/lib/services/promoService\";\r\nimport { adaptApiPromo } from \"@/lib/promo-adapter\";\r\nimport { ProductoConPromo, Producto } from \"@/lib/types\";\r\n\r\nexport function useProductosPromo() {\r\n    const [productos, setProductos] = useState<ProductoConPromo[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<Error | null>(null);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                // Obtener todos los datos necesarios desde los servicios en paralelo\r\n                const [productosResponse, promos, rel] = await Promise.all([\r\n                    getProducts(),\r\n                    getPromos(),\r\n                    getProductPromoRelations(),\r\n                ]);\r\n\r\n                // Extraer el array de productos de la propiedad \"products\" de la respuesta\r\n                const productosArray: Producto[] = productosResponse.products;\r\n\r\n                // Validar que la respuesta sea un array antes de continuar\r\n                if (!Array.isArray(productosArray)) {\r\n                    throw new Error(\r\n                        \"La respuesta de la API de productos no es un array válido.\"\r\n                    );\r\n                }\r\n\r\n                // 4. Mapear los productos para combinar y adaptar la información de las promociones\r\n                const productosConPromo = productosArray.map((producto) => {\r\n                    // Encontrar la relación para el producto actual\r\n                    const relPromo = rel.products.find(\r\n                        (rp) => rp.idProducto === producto.id\r\n                    );\r\n\r\n                    // Si hay relación, encontrar el objeto de la promoción completa\r\n                    const promoData = relPromo\r\n                        ? promos.promotions.find(\r\n                              (p) => p.id === relPromo.idPromo\r\n                          )\r\n                        : undefined;\r\n\r\n                    // Adaptar el objeto de la promoción a un formato seguro para el frontend\r\n                    const promoAplicada = adaptApiPromo(promoData);\r\n\r\n                    // Retornar el objeto de producto final con la promoción integrada\r\n                    return { ...producto, promo: promoAplicada };\r\n                });\r\n\r\n                setProductos(productosConPromo);\r\n            } catch (err) {\r\n                // Capturar cualquier error durante el proceso y guardarlo en el estado\r\n                setError(err as Error);\r\n            } finally {\r\n                // Asegurarse de que el estado de carga siempre se desactive al final\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n    }, []); // El array de dependencias vacío asegura que esto se ejecute solo una vez\r\n\r\n    // Devolver el estado completo para que los componentes puedan reaccionar\r\n    return { productos, loading, error };\r\n}\r\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;AAE7B;AACA;AACA;AAIA;;;;;AAGO,SAAS;IACZ,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAsB,EAAE;IACjE,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAgB;IAEjD,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACN,MAAM,YAAY;YACd,IAAI;gBACA,qEAAqE;gBACrE,MAAM,CAAC,mBAAmB,QAAQ,IAAI,GAAG,MAAM,QAAQ,GAAG,CAAC;oBACvD,CAAA,GAAA,iIAAA,CAAA,cAAW,AAAD;oBACV,CAAA,GAAA,+HAAA,CAAA,YAAS,AAAD;oBACR,CAAA,GAAA,+HAAA,CAAA,2BAAwB,AAAD;iBAC1B;gBAED,2EAA2E;gBAC3E,MAAM,iBAA6B,kBAAkB,QAAQ;gBAE7D,2DAA2D;gBAC3D,IAAI,CAAC,MAAM,OAAO,CAAC,iBAAiB;oBAChC,MAAM,IAAI,MACN;gBAER;gBAEA,oFAAoF;gBACpF,MAAM,oBAAoB,eAAe,GAAG,CAAC,CAAC;oBAC1C,gDAAgD;oBAChD,MAAM,WAAW,IAAI,QAAQ,CAAC,IAAI,CAC9B,CAAC,KAAO,GAAG,UAAU,KAAK,SAAS,EAAE;oBAGzC,gEAAgE;oBAChE,MAAM,YAAY,WACZ,OAAO,UAAU,CAAC,IAAI,CAClB,CAAC,IAAM,EAAE,EAAE,KAAK,SAAS,OAAO,IAEpC;oBAEN,yEAAyE;oBACzE,MAAM,gBAAgB,CAAA,GAAA,uHAAA,CAAA,gBAAa,AAAD,EAAE;oBAEpC,kEAAkE;oBAClE,OAAO;wBAAE,GAAG,QAAQ;wBAAE,OAAO;oBAAc;gBAC/C;gBAEA,aAAa;YACjB,EAAE,OAAO,KAAK;gBACV,uEAAuE;gBACvE,SAAS;YACb,SAAU;gBACN,qEAAqE;gBACrE,WAAW;YACf;QACJ;QAEA;IACJ,GAAG,EAAE,GAAG,0EAA0E;IAElF,yEAAyE;IACzE,OAAO;QAAE;QAAW;QAAS;IAAM;AACvC","debugId":null}},
    {"offset": {"line": 258, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/app/%28routes%29/productos/components/OptionSelect.tsx"],"sourcesContent":["\"use client\";\r\n\r\ntype Props = {\r\n  label: string;\r\n  value?: string | number;\r\n  options?: (string | number)[] | null;\r\n  onChange: (v: string) => void;\r\n};\r\n\r\n/**\r\n * Selector genérico para variantes de producto (tamaño, sabor, etc.).\r\n */\r\nexport default function OptionSelect({\r\n  label,\r\n  value,\r\n  options,\r\n  onChange,\r\n}: Props) {\r\n  const safeOptions = Array.isArray(options) ? options : [];\r\n\r\n  return (\r\n    <div className=\"space-y-1\">\r\n      <label className=\"block font-semibold capitalize dark:text-gray-400\">\r\n        {label}\r\n      </label>\r\n\r\n      <div className=\"relative\">\r\n        <select\r\n          value={value}\r\n          onChange={(e) => onChange(e.target.value)}\r\n          className=\"w-full appearance-none rounded-lg border border-gray-300 bg-white\r\n                     px-3 py-2 pr-10 text-gray-800 focus:outline-none focus:ring-2\r\n                     focus:ring-green-400 dark:border-gray-600 dark:bg-[#ffd68a] dark:text-gray-800\">\r\n          {safeOptions.map((v) => (\r\n            <option key={v}>{v}</option>\r\n          ))}\r\n        </select>\r\n\r\n        {/* flecha */}\r\n        <svg\r\n          className=\"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-600\"\r\n          fill=\"currentColor\"\r\n          viewBox=\"0 0 20 20\">\r\n          <path\r\n            d=\"M7 7l3 3 3-3\"\r\n            stroke=\"currentColor\"\r\n            strokeWidth={2}\r\n            fill=\"none\"\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n          />\r\n        </svg>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAYe,SAAS,aAAa,EACnC,KAAK,EACL,KAAK,EACL,OAAO,EACP,QAAQ,EACF;IACN,MAAM,cAAc,MAAM,OAAO,CAAC,WAAW,UAAU,EAAE;IAEzD,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAM,WAAU;0BACd;;;;;;0BAGH,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,OAAO;wBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBACxC,WAAU;kCAGT,YAAY,GAAG,CAAC,CAAC,kBAChB,8OAAC;0CAAgB;+BAAJ;;;;;;;;;;kCAKjB,8OAAC;wBACC,WAAU;wBACV,MAAK;wBACL,SAAQ;kCACR,cAAA,8OAAC;4BACC,GAAE;4BACF,QAAO;4BACP,aAAa;4BACb,MAAK;4BACL,eAAc;4BACd,gBAAe;;;;;;;;;;;;;;;;;;;;;;;AAM3B","debugId":null}},
    {"offset": {"line": 336, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/app/%28routes%29/productos/%5Bslug%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { useMemo, useState, useEffect } from \"react\";\r\nimport Image from \"next/image\";\r\nimport { LoaderCircle, AlertTriangle, Minus, Plus } from \"lucide-react\";\r\n\r\nimport { useProductosPromo } from \"@/hooks/useProductsPromo\";\r\nimport { slugify } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nimport { useCart } from \"@/lib/cart-context\";\r\nimport OptionSelect from \"../components/OptionSelect\";\r\n\r\nexport default function ProductDetailPage() {\r\n    const { slug } = useParams<{ slug: string }>();\r\n    const router = useRouter();\r\n\r\n    const { productos, loading, error } = useProductosPromo();\r\n\r\n    const productoEncontrado = useMemo(() => {\r\n        if (loading || !slug) return null;\r\n        return productos.find((p) => slugify(p.name) === slug);\r\n    }, [productos, slug, loading]);\r\n\r\n    // ESTADO PARA LAS OPCIONES SELECCIONADAS Y CANTIDAD\r\n    const [quantity, setQuantity] = useState(1);\r\n    const [selectedOptions, setSelectedOptions] = useState<\r\n        Record<string, string>\r\n    >({});\r\n\r\n    // INICIALIZAR LAS OPCIONES POR DEFECTO CUANDO EL PRODUCTO SE ENCUENTRA\r\n    useEffect(() => {\r\n        if (productoEncontrado?.options) {\r\n            const defaultOptions: Record<string, string> = {};\r\n            Object.entries(productoEncontrado.options).forEach(\r\n                ([key, valueArray]) => {\r\n                    if (Array.isArray(valueArray) && valueArray.length > 0) {\r\n                        defaultOptions[key] = valueArray[0];\r\n                    }\r\n                }\r\n            );\r\n            setSelectedOptions(defaultOptions);\r\n        }\r\n        // Resetea la cantidad a 1 cada vez que cambia el producto\r\n        setQuantity(1);\r\n    }, [productoEncontrado]);\r\n\r\n    // FUNCIÓN PARA MANEJAR EL CAMBIO DE OPCIONES\r\n    const handleOptionChange = (optionName: string, value: string) => {\r\n        setSelectedOptions((prev) => ({ ...prev, [optionName]: value }));\r\n    };\r\n\r\n    // FUNCIÓN PARA AÑADIR AL CARRITO\r\n    const { addItem } = useCart();\r\n\r\n    const handleAddToCart = () => {\r\n        if (!productoEncontrado) return;\r\n\r\n        // Usamos una función similar a `addWithOpts`\r\n        addItem({\r\n            id: `${productoEncontrado.id}-${Object.values(selectedOptions).join(\r\n                \"-\"\r\n            )}`, // Crea un ID único para el item en el carrito\r\n            name: productoEncontrado.name,\r\n            price: productoEncontrado.price,\r\n            image: productoEncontrado.image,\r\n            quantity: quantity,\r\n            options: selectedOptions,\r\n            promo: productoEncontrado.promo,\r\n        });\r\n\r\n        // Notificación de éxito\r\n        alert(`${quantity} x ${productoEncontrado.name} añadido al carrito!`);\r\n        router.push(\"/productos\"); // Vuelve al catálogo\r\n    };\r\n\r\n    // Manejo de estados de carga, error o si no se encuentra el producto\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen flex justify-center items-center\">\r\n                <LoaderCircle className=\"w-12 h-12 animate-spin\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"min-h-screen flex flex-col justify-center items-center text-red-500\">\r\n                <AlertTriangle className=\"w-12 h-12 mb-4\" />\r\n                <h2 className=\"text-2xl font-bold\">\r\n                    Error al cargar productos.\r\n                </h2>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!productoEncontrado) {\r\n        return (\r\n            <div className=\"min-h-screen flex flex-col justify-center items-center\">\r\n                <AlertTriangle className=\"w-12 h-12 mb-4\" />\r\n                <h2 className=\"text-2xl font-bold\">Producto no encontrado</h2>\r\n                <Button\r\n                    onClick={() => router.push(\"/productos\")}\r\n                    className=\"mt-4\">\r\n                    Volver a la tienda\r\n                </Button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <main className=\"container mx-auto p-4 md:p-8\">\r\n            <div className=\"grid md:grid-cols-2 gap-8 lg:gap-12\">\r\n                <div className=\"bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-8\">\r\n                    <Image\r\n                        src={productoEncontrado.image}\r\n                        alt={productoEncontrado.name}\r\n                        width={400}\r\n                        height={400}\r\n                        className=\"object-contain\"\r\n                        priority\r\n                    />\r\n                </div>\r\n                <div className=\"flex flex-col\">\r\n                    <h1 className=\"text-4xl lg:text-5xl font-bold font-simpson text-blue-700 mb-4\">\r\n                        {productoEncontrado.name}\r\n                    </h1>\r\n                    <p className=\"text-lg text-gray-600 dark:text-gray-300 mb-6\">\r\n                        {productoEncontrado.description}\r\n                    </p>\r\n\r\n                    <div className=\"space-y-4 mb-6\">\r\n                        {productoEncontrado.options &&\r\n                            Object.entries(productoEncontrado.options).map(\r\n                                ([key, values]) =>\r\n                                    Array.isArray(values) &&\r\n                                    values.length > 0 && (\r\n                                        <div key={key}>\r\n                                            <OptionSelect\r\n                                                options={values}\r\n                                                value={selectedOptions[key]}\r\n                                                onChange={(value) =>\r\n                                                    handleOptionChange(\r\n                                                        key,\r\n                                                        value\r\n                                                    )\r\n                                                }\r\n                                                label={\"Seleccione una opción\"}\r\n                                            />\r\n                                        </div>\r\n                                    )\r\n                            )}\r\n                    </div>\r\n\r\n                    <div className=\"text-4xl font-extrabold text-green-600 mb-6\">\r\n                        ${productoEncontrado.price.toFixed(2)}\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-4 mt-4\">\r\n                        <div className=\"flex items-center border rounded-md\">\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                onClick={() =>\r\n                                    setQuantity(Math.max(1, quantity - 1))\r\n                                }>\r\n                                <Minus className=\"w-4 h-4\" />\r\n                            </Button>\r\n                            <span className=\"w-12 text-center font-bold\">\r\n                                {quantity}\r\n                            </span>\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                onClick={() => setQuantity(quantity + 1)}>\r\n                                <Plus className=\"w-4 h-4\" />\r\n                            </Button>\r\n                        </div>\r\n\r\n                        <Button\r\n                            size=\"lg\"\r\n                            className=\"bg-green-500 hover:bg-green-600 flex-grow\"\r\n                            onClick={handleAddToCart}>\r\n                            Añadir {quantity} al carrito\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </main>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAZA;;;;;;;;;;;AAce,SAAS;IACpB,MAAM,EAAE,IAAI,EAAE,GAAG,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACzB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IAEvB,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,0HAAA,CAAA,oBAAiB,AAAD;IAEtD,MAAM,qBAAqB,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QAC/B,IAAI,WAAW,CAAC,MAAM,OAAO;QAC7B,OAAO,UAAU,IAAI,CAAC,CAAC,IAAM,CAAA,GAAA,4GAAA,CAAA,UAAO,AAAD,EAAE,EAAE,IAAI,MAAM;IACrD,GAAG;QAAC;QAAW;QAAM;KAAQ;IAE7B,oDAAoD;IACpD,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAEnD,CAAC;IAEH,uEAAuE;IACvE,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACN,IAAI,oBAAoB,SAAS;YAC7B,MAAM,iBAAyC,CAAC;YAChD,OAAO,OAAO,CAAC,mBAAmB,OAAO,EAAE,OAAO,CAC9C,CAAC,CAAC,KAAK,WAAW;gBACd,IAAI,MAAM,OAAO,CAAC,eAAe,WAAW,MAAM,GAAG,GAAG;oBACpD,cAAc,CAAC,IAAI,GAAG,UAAU,CAAC,EAAE;gBACvC;YACJ;YAEJ,mBAAmB;QACvB;QACA,0DAA0D;QAC1D,YAAY;IAChB,GAAG;QAAC;KAAmB;IAEvB,6CAA6C;IAC7C,MAAM,qBAAqB,CAAC,YAAoB;QAC5C,mBAAmB,CAAC,OAAS,CAAC;gBAAE,GAAG,IAAI;gBAAE,CAAC,WAAW,EAAE;YAAM,CAAC;IAClE;IAEA,iCAAiC;IACjC,MAAM,EAAE,OAAO,EAAE,GAAG,CAAA,GAAA,uHAAA,CAAA,UAAO,AAAD;IAE1B,MAAM,kBAAkB;QACpB,IAAI,CAAC,oBAAoB;QAEzB,6CAA6C;QAC7C,QAAQ;YACJ,IAAI,GAAG,mBAAmB,EAAE,CAAC,CAAC,EAAE,OAAO,MAAM,CAAC,iBAAiB,IAAI,CAC/D,MACD;YACH,MAAM,mBAAmB,IAAI;YAC7B,OAAO,mBAAmB,KAAK;YAC/B,OAAO,mBAAmB,KAAK;YAC/B,UAAU;YACV,SAAS;YACT,OAAO,mBAAmB,KAAK;QACnC;QAEA,wBAAwB;QACxB,MAAM,GAAG,SAAS,GAAG,EAAE,mBAAmB,IAAI,CAAC,oBAAoB,CAAC;QACpE,OAAO,IAAI,CAAC,eAAe,qBAAqB;IACpD;IAEA,qEAAqE;IACrE,IAAI,SAAS;QACT,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC,sNAAA,CAAA,eAAY;gBAAC,WAAU;;;;;;;;;;;IAGpC;IAEA,IAAI,OAAO;QACP,qBACI,8OAAC;YAAI,WAAU;;8BACX,8OAAC,wNAAA,CAAA,gBAAa;oBAAC,WAAU;;;;;;8BACzB,8OAAC;oBAAG,WAAU;8BAAqB;;;;;;;;;;;;IAK/C;IAEA,IAAI,CAAC,oBAAoB;QACrB,qBACI,8OAAC;YAAI,WAAU;;8BACX,8OAAC,wNAAA,CAAA,gBAAa;oBAAC,WAAU;;;;;;8BACzB,8OAAC;oBAAG,WAAU;8BAAqB;;;;;;8BACnC,8OAAC,2HAAA,CAAA,SAAM;oBACH,SAAS,IAAM,OAAO,IAAI,CAAC;oBAC3B,WAAU;8BAAO;;;;;;;;;;;;IAKjC;IAEA,qBACI,8OAAC;QAAK,WAAU;kBACZ,cAAA,8OAAC;YAAI,WAAU;;8BACX,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC,6HAAA,CAAA,UAAK;wBACF,KAAK,mBAAmB,KAAK;wBAC7B,KAAK,mBAAmB,IAAI;wBAC5B,OAAO;wBACP,QAAQ;wBACR,WAAU;wBACV,QAAQ;;;;;;;;;;;8BAGhB,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAG,WAAU;sCACT,mBAAmB,IAAI;;;;;;sCAE5B,8OAAC;4BAAE,WAAU;sCACR,mBAAmB,WAAW;;;;;;sCAGnC,8OAAC;4BAAI,WAAU;sCACV,mBAAmB,OAAO,IACvB,OAAO,OAAO,CAAC,mBAAmB,OAAO,EAAE,GAAG,CAC1C,CAAC,CAAC,KAAK,OAAO,GACV,MAAM,OAAO,CAAC,WACd,OAAO,MAAM,GAAG,mBACZ,8OAAC;8CACG,cAAA,8OAAC,6JAAA,CAAA,UAAY;wCACT,SAAS;wCACT,OAAO,eAAe,CAAC,IAAI;wCAC3B,UAAU,CAAC,QACP,mBACI,KACA;wCAGR,OAAO;;;;;;mCAVL;;;;;;;;;;sCAiB9B,8OAAC;4BAAI,WAAU;;gCAA8C;gCACvD,mBAAmB,KAAK,CAAC,OAAO,CAAC;;;;;;;sCAGvC,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAI,WAAU;;sDACX,8OAAC,2HAAA,CAAA,SAAM;4CACH,SAAQ;4CACR,MAAK;4CACL,SAAS,IACL,YAAY,KAAK,GAAG,CAAC,GAAG,WAAW;sDAEvC,cAAA,8OAAC,oMAAA,CAAA,QAAK;gDAAC,WAAU;;;;;;;;;;;sDAErB,8OAAC;4CAAK,WAAU;sDACX;;;;;;sDAEL,8OAAC,2HAAA,CAAA,SAAM;4CACH,SAAQ;4CACR,MAAK;4CACL,SAAS,IAAM,YAAY,WAAW;sDACtC,cAAA,8OAAC,kMAAA,CAAA,OAAI;gDAAC,WAAU;;;;;;;;;;;;;;;;;8CAIxB,8OAAC,2HAAA,CAAA,SAAM;oCACH,MAAK;oCACL,WAAU;oCACV,SAAS;;wCAAiB;wCAClB;wCAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO7C","debugId":null}}]
}