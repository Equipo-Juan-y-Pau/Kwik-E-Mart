{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/lib/services/promoService.ts"],"sourcesContent":["import { Promo } from \"../types\";\r\n\r\n// Sólo necesitamos estos dos campos al crear la relación:\r\nexport type PromoProductCreate = {\r\n  idPromo: number;\r\n  idProducto: number;\r\n};\r\n\r\nconst API_BASE_URL = \"/api/8080/catalog-service\";\r\n\r\n/** Crea la relación promo–producto */\r\nexport async function assignPromoToProduct(\r\n  relation: PromoProductCreate\r\n): Promise<void> {\r\n  const res = await fetch(\r\n    `${API_BASE_URL}/promotions/promo-productos/`,\r\n    {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(relation),\r\n    }\r\n  );\r\n  if (!res.ok) {\r\n    throw new Error(\"Error al asignar la promoción al producto\");\r\n  }\r\n}\r\n\r\n/** Obtiene todas las promociones */\r\nexport async function getPromos(): Promise<{ promotions: Promo[] }> {\r\n  const res = await fetch(`${API_BASE_URL}/promotions/`);\r\n  if (!res.ok) throw new Error(\"No se pudieron obtener las promociones\");\r\n  return res.json();\r\n}\r\n\r\n/** Obtiene todas las relaciones promo–producto */\r\nexport async function getProductPromoRelations(): Promise<{\r\n  products: { idPromo: number; idProducto: number }[];\r\n}> {\r\n  const res = await fetch(\r\n    `${API_BASE_URL}/promotions/promo-productos/`\r\n  );\r\n  if (!res.ok) throw new Error(\"No se pudieron obtener las relaciones\");\r\n  return res.json();\r\n}\r\n"],"names":[],"mappings":";;;;;AAQA,MAAM,eAAe;AAGd,eAAe,qBACpB,QAA4B;IAE5B,MAAM,MAAM,MAAM,MAChB,GAAG,aAAa,4BAA4B,CAAC,EAC7C;QACE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEF,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,IAAI,MAAM;IAClB;AACF;AAGO,eAAe;IACpB,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,YAAY,CAAC;IACrD,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,IAAI;AACjB;AAGO,eAAe;IAGpB,MAAM,MAAM,MAAM,MAChB,GAAG,aAAa,4BAA4B,CAAC;IAE/C,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,IAAI;AACjB","debugId":null}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/lib/services/productService.ts"],"sourcesContent":["import { Producto } from \"@/lib/types\";\r\nimport { refresh } from \"./userService\"; // si quieres auto‑refresh\r\n\r\nconst API_BASE_URL = \"/api/8080/catalog-service\";\r\n\r\n/* ------------------------------------------------------------------ */\r\n/* Helper para añadir Authorization                                    */\r\n/* ------------------------------------------------------------------ */\r\nconst authHeader = (): HeadersInit => {\r\n    const token = localStorage.getItem(\"accessToken\");\r\n    console.log(\"Auth header:\", token)\r\n    return token ? { Authorization: `Bearer ${token}` } : {};\r\n};\r\n\r\n/* ------------------------------------------------------------------ */\r\n/* 1.  Rutas PÚBLICAS                                                  */\r\n/* ------------------------------------------------------------------ */\r\n\r\nexport async function getProducts(): Promise<{ products: Producto[] }> {\r\n    const res = await fetch(`${API_BASE_URL}/products/`);\r\n    if (!res.ok)\r\n        throw new Error(\"No se pudieron obtener los productos del Kwik‑E‑Mart\");\r\n    return res.json();\r\n}\r\n\r\nexport async function getProductById(id: number): Promise<Producto> {\r\n    const res = await fetch(`${API_BASE_URL}/products/${id}`);\r\n    if (!res.ok)\r\n        throw new Error(`No se pudo encontrar el producto con ID ${id}`);\r\n    return res.json();\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/* 2.  Rutas PROTEGIDAS (requieren JWT)                               */\r\n/* ------------------------------------------------------------------ */\r\n\r\nexport async function createProduct(\r\n    product: Omit<Producto, \"id\">\r\n): Promise<Producto> {\r\n    const res = await fetch(`${API_BASE_URL}/products/`, {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            ...authHeader(),\r\n        },\r\n        body: JSON.stringify(product),\r\n    });\r\n\r\n    if (res.status === 401) {\r\n        throw new Error(\"No autorizado: inicia sesión de nuevo.\");\r\n    }\r\n\r\n    if (!res.ok) throw new Error(\"Error al intentar crear el producto\");\r\n    return res.json();\r\n}\r\n\r\nexport async function updateProduct(\r\n    id: number,\r\n    product: Partial<Producto>\r\n): Promise<Producto> {\r\n    const res = await fetch(`${API_BASE_URL}/products/${id}`, {\r\n        method: \"PUT\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            ...authHeader(),\r\n        },\r\n        body: JSON.stringify(product),\r\n    });\r\n\r\n    if (res.status === 401)\r\n        throw new Error(\"No autorizado: inicia sesión de nuevo.\");\r\n    if (!res.ok) throw new Error(`Error al actualizar el producto ${id}`);\r\n    return res.json();\r\n}\r\n\r\nexport async function deleteProduct(id: number): Promise<void> {\r\n    const res = await fetch(`${API_BASE_URL}/products/${id}`, {\r\n        method: \"DELETE\",\r\n        headers: authHeader(),\r\n    });\r\n\r\n    if (res.status === 401)\r\n        throw new Error(\"No autorizado: inicia sesión de nuevo.\");\r\n    if (!res.ok) throw new Error(`Error al eliminar el producto ${id}`);\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAGA,MAAM,eAAe;AAErB,sEAAsE,GACtE,uEAAuE,GACvE,sEAAsE,GACtE,MAAM,aAAa;IACf,MAAM,QAAQ,aAAa,OAAO,CAAC;IACnC,QAAQ,GAAG,CAAC,gBAAgB;IAC5B,OAAO,QAAQ;QAAE,eAAe,CAAC,OAAO,EAAE,OAAO;IAAC,IAAI,CAAC;AAC3D;AAMO,eAAe;IAClB,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,CAAC;IACnD,IAAI,CAAC,IAAI,EAAE,EACP,MAAM,IAAI,MAAM;IACpB,OAAO,IAAI,IAAI;AACnB;AAEO,eAAe,eAAe,EAAU;IAC3C,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,EAAE,IAAI;IACxD,IAAI,CAAC,IAAI,EAAE,EACP,MAAM,IAAI,MAAM,CAAC,wCAAwC,EAAE,IAAI;IACnE,OAAO,IAAI,IAAI;AACnB;AAMO,eAAe,cAClB,OAA6B;IAE7B,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,CAAC,EAAE;QACjD,QAAQ;QACR,SAAS;YACL,gBAAgB;YAChB,GAAG,YAAY;QACnB;QACA,MAAM,KAAK,SAAS,CAAC;IACzB;IAEA,IAAI,IAAI,MAAM,KAAK,KAAK;QACpB,MAAM,IAAI,MAAM;IACpB;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,IAAI;AACnB;AAEO,eAAe,cAClB,EAAU,EACV,OAA0B;IAE1B,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,EAAE,IAAI,EAAE;QACtD,QAAQ;QACR,SAAS;YACL,gBAAgB;YAChB,GAAG,YAAY;QACnB;QACA,MAAM,KAAK,SAAS,CAAC;IACzB;IAEA,IAAI,IAAI,MAAM,KAAK,KACf,MAAM,IAAI,MAAM;IACpB,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,gCAAgC,EAAE,IAAI;IACpE,OAAO,IAAI,IAAI;AACnB;AAEO,eAAe,cAAc,EAAU;IAC1C,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,EAAE,IAAI,EAAE;QACtD,QAAQ;QACR,SAAS;IACb;IAEA,IAAI,IAAI,MAAM,KAAK,KACf,MAAM,IAAI,MAAM;IACpB,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,IAAI;AACtE","debugId":null}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/juanf/OneDrive/Desktop/desarrolloweb/Kwik-E-Mart/frontend/kwik-e-mart/app/admin/asignar/page.tsx"],"sourcesContent":["// app/admin/asignar/page.tsx\r\n'use client';\r\n\r\nimport { useState, useEffect, FormEvent } from 'react';\r\nimport clsx from 'clsx';\r\nimport { getProductPromoRelations, assignPromoToProduct } from '@/lib/services/promoService';\r\nimport { getProducts } from '@/lib/services/productService';\r\nimport { getPromos } from '@/lib/services/promoService';\r\n\r\ninterface Producto { id: number; name: string }\r\ninterface Promo     { id: number; nombre: string; descripcion: string }\r\ninterface Rel       { idPromo: number; idProducto: number }\r\n\r\nexport default function AsignarPromosPage() {\r\n  const [productos, setProductos] = useState<Producto[]>([]);\r\n  const [promos,     setPromos]   = useState<Promo[]>([]);\r\n  const [relations,  setRelations]= useState<Rel[]>([]);\r\n\r\n  const [productoId, setProductoId] = useState<number | ''>('');\r\n  const [promoId,    setPromoId]    = useState<number | ''>('');\r\n  const [msg,        setMsg]        = useState<{ ok?: string; err?: string }>({});\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const pr = await getProducts();        setProductos(pr.products);\r\n      const pm = await getPromos();          setPromos(pm.promotions);\r\n      const rel = await getProductPromoRelations(); setRelations(rel.products);\r\n    })();\r\n  }, []);\r\n\r\n  const reloadRelations = async () => {\r\n    const rel = await getProductPromoRelations();\r\n    setRelations(rel.products);\r\n  };\r\n\r\n  const handleSubmit = async (e: FormEvent) => {\r\n    e.preventDefault();\r\n    setMsg({});\r\n    if (productoId === '' || promoId === '') {\r\n      return setMsg({ err: 'Selecciona un producto y una promoción.' });\r\n    }\r\n    try {\r\n      await assignPromoToProduct({ idProducto: productoId, idPromo: promoId });\r\n      setMsg({ ok: '¡Promoción asignada correctamente!' });\r\n      setProductoId(''); setPromoId('');\r\n      await reloadRelations();\r\n    } catch {\r\n      setMsg({ err: 'Error al asignar la promoción.' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <main className=\"min-h-screen p-6 bg-gray-50\">\r\n      <div className=\"mx-auto max-w-3xl space-y-8\">\r\n        <h1 className=\"text-3xl font-bold text-gray-800\">\r\n          Asignar Promoción a Producto\r\n        </h1>\r\n\r\n        <section className=\"bg-white p-6 rounded-lg shadow\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <Select\r\n              label=\"Producto\"\r\n              value={productoId}\r\n              onChange={setProductoId}\r\n              placeholder=\"Selecciona un producto…\"\r\n              options={productos.map(p => ({ value: p.id, label: p.name }))}\r\n              color=\"yellow\"\r\n            />\r\n\r\n            <Select\r\n              label=\"Promoción\"\r\n              value={promoId}\r\n              onChange={setPromoId}\r\n              placeholder=\"Selecciona una promoción…\"\r\n              options={promos.map(p => ({\r\n                value: p.id,\r\n                label: `${p.nombre} — ${p.descripcion}`,\r\n              }))}\r\n              color=\"blue\"\r\n            />\r\n\r\n            {msg.err && <p className=\"text-sm text-red-600\">{msg.err}</p>}\r\n            {msg.ok  && <p className=\"text-sm text-green-600\">{msg.ok}</p>}\r\n\r\n            <button\r\n              type=\"submit\"\r\n              className=\"w-full rounded-lg bg-blue-600 py-2 text-white font-semibold hover:bg-blue-700\"\r\n            >\r\n              Asignar Promoción\r\n            </button>\r\n          </form>\r\n        </section>\r\n\r\n        <section className=\"bg-white p-6 rounded-lg shadow\">\r\n          <h2 className=\"mb-4 text-2xl font-semibold text-gray-700\">\r\n            Asignaciones existentes\r\n          </h2>\r\n          {relations.length === 0 ? (\r\n            <p className=\"text-gray-500\">No hay asignaciones aún.</p>\r\n          ) : (\r\n            <ul className=\"space-y-2\">\r\n              {relations.map((r, i) => {\r\n                const prod = productos.find(p => p.id === r.idProducto);\r\n                const promo= promos.find(p => p.id === r.idPromo);\r\n                return (\r\n                  <li\r\n                    key={i}\r\n                    className=\"flex justify-between rounded border px-4 py-2\"\r\n                  >\r\n                    <span>\r\n                      <strong>{prod?.name || r.idProducto}</strong> ↔{' '}\r\n                      <em>{promo?.nombre || r.idPromo}</em>\r\n                    </span>\r\n                  </li>\r\n                );\r\n              })}\r\n            </ul>\r\n          )}\r\n        </section>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\ntype SelectOption = { value: number; label: string };\r\nfunction Select({\r\n  label, value, onChange, placeholder, options, color,\r\n}: {\r\n  label: string;\r\n  value: number | '';\r\n  onChange: (v: number | '') => void;\r\n  placeholder: string;\r\n  options: SelectOption[];\r\n  color: 'yellow' | 'blue';\r\n}) {\r\n  return (\r\n    <div className=\"space-y-1\">\r\n      <label className=\"block text-sm font-medium text-gray-700\">{label}</label>\r\n      <select\r\n        value={value}\r\n        onChange={e =>\r\n          onChange(e.target.value === '' ? '' : Number(e.target.value))\r\n        }\r\n        className={clsx(\r\n          'block w-full rounded-md px-3 py-2 text-base border-2 focus:outline-none focus:ring-2 focus:ring-offset-1',\r\n          color === 'yellow'\r\n            ? 'border-yellow-400 focus:ring-yellow-300'\r\n            : 'border-blue-400 focus:ring-blue-300',\r\n          !value && 'text-gray-400'\r\n        )}\r\n      >\r\n        <option value=\"\">{placeholder}</option>\r\n        {options.length === 0 && <option disabled>Sin datos aún</option>}\r\n        {options.map(o => (\r\n          <option key={o.value} value={o.value}>\r\n            {o.label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}